pipeline {
   agent any
   environment{
    SCANNER_HOME= tool "sonar-scanner"
   }
      stages{
         stage('checkout'){
               steps{
                 git changelog: false, credentialsId: 'new-github-token', poll: false, url: 'https://github.com/medinahakinsowon/Ibt-maven.git'
               }
         }
         stage('Validate'){
              steps{
                 sh 'mvn validate'
              }
         }
         stage('compile'){
               steps{
                  sh 'mvn compile'
               }
         }
         stage('test'){
               steps{
                  sh 'mvn test'
               }
         }
         stage('SonarQube Analysis') {
         environment{
           sonarScan= tool 'sonar-scanner'
         }
          steps{
             withSonarQubeEnv(credentialsId: 'sonar-token', installationName:'sonar-server') {
                           sh "$sonarScan/bin/sonar-scanner -Dsonar.projectKey=Ibt-maven"
                         }
          }
         }
      }
   }


